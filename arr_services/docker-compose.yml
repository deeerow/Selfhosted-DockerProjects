x-app: &default
  restart: unless-stopped
  networks:
    -  proxy
  environment: &environment
    TZ: America/Vancouver
    PGID: ${PGID:?err}
    PUID: ${PUID:?err}
    UMASK: ${UMASK:?err}
  labels: &labels
    traefik.enable: true
    com.centurylinklabs.watchtower.enable: true
  security_opt:
    - no-new-privileges:true

services:
  radarr:
    <<: *default
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    expose:
      - 7878
    volumes:
      - ./radarr:/config
      - ${MEDIA_DIR:?err}:/data
    labels:
      <<: *labels
      traefik.http.routers.radarr.middlewares: auth@file

  sonarr:
    <<: *default
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    expose:
      - 8989
    volumes:
      - ./sonarr:/config
      - ${MEDIA_DIR:?err}:/data
    labels:
      <<: *labels
      traefik.http.routers.sonarr.middlewares: auth@file

  prowlarr:
    <<: *default
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    expose:
      - 9696
    volumes:
      - ./prowlarr:/config
    labels:
      <<: *labels
      traefik.http.routers.prowlarr.middlewares: auth@file

  notifiarr:
    <<: *default
    container_name: notifiarr
    hostname: notifiarr
    image: golift/notifiarr:latest
    expose:
      - 5454
    volumes:
      - ./notifiarr:/config
      - /var/run/utmp:/var/run/utmp
    labels:
      <<: *labels
      traefik.http.routers.notifiarr.middlewares: auth@file

  flaresolverr:
    <<: *default
    container_name: flaresolverr
    hostname: flaresolverr
    image: ghcr.io/flaresolverr/flaresolverr:latest
    expose:
      - 8191
    labels:
      <<: *labels
      traefik.http.routers.flaresolverr.middlewares: auth@file

  dispatcharr:
    <<: *default
    image: ghcr.io/dispatcharr/dispatcharr:latest
    container_name: dispatcharr
    expose:
      - 9191
    volumes:
      - ./dispatcharr:/data    # /data/db needs to be 700or750 permissions
    labels:
      <<: *labels
      traefik.http.routers.dispatcharr.middlewares: auth@file
    environment:
      <<: *environment
      DISPATCHARR_ENV: aio
      REDIS_HOST: localhost
      CELERY_BROKER_URL: redis://localhost:6379/0
      DISPATCHARR_LOG_LEVEL: info

volumes:
  dispatcharr:

networks:
  proxy:
    external: true
